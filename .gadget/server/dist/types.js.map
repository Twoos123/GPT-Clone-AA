{
  "version": 3,
  "sources": ["../src/types.ts"],
  "sourcesContent": ["import type { AnyClient, GadgetRecord } from \"@gadgetinc/api-client-core\";\nimport type { FastifyReply, FastifyRequest } from \"fastify\";\nimport type { Logger } from \"./AmbientContext\";\nimport type { Session } from \"./Session\";\nimport type {\n  JSONTransportConfig,\n  SESTransportConfig,\n  SMTPTransportConfig,\n  SendmailTransportConfig,\n  StreamTransportConfig,\n} from \"./nodemailer-transports\";\nimport type { AppTenancy, AppTenancyKey } from \"./tenancy\";\n\n/**\n * An object passed between all preconditions and effects of an action execution at the `scope` property.\n * Useful for transferring data between effects.\n **/\nexport interface ActionExecutionScope {\n  recordDeleted?: boolean;\n  [key: string]: any;\n}\n\n/** Information about the current request being processed by Gadget. */\nexport interface RequestData {\n  /** The remote IP address of the request */\n  ip: string;\n  /** The requested URL */\n  url: string;\n  /** The HTTP method for this request (like GET, POST, etc) */\n  method: string;\n  /** A unique identifier for this request */\n  id: string;\n  /** The user agent header of the request */\n  userAgent?: string;\n  /** Headers passed to this request */\n  headers: Record<string, string | string[] | undefined>;\n}\n\n/** Describes an action triggered by running a Shopify webhook */\nexport interface ShopifyWebhookActionTrigger {\n  type: \"shopify_webhook\";\n  /** The topic of the incoming webhook from Shopify, like products/update or orders/create */\n  topic: string;\n  /** The raw incoming payload from Shopify */\n  payload: Record<string, any>;\n  /** The ID of the shop receiving the webhook */\n  shopId: string;\n  /** The number of times this webhook has been retried */\n  retries: number;\n}\n\nexport interface PublicAPIActionTrigger {\n  /** Mutation name called in the API */\n  mutationName: string;\n  /** Model identifier the mutation was called on. Usually the same as the model the action is being run on, but will be different if the action is nested. Is not set for global actions. */\n  rootModel?: string;\n  /** Action identifier triggered by the mutation. Usually the same as the action is being run, but will be different if the current action is nested */\n  rootAction: string;\n  /** The params passed to this API call, including any data for nested actions if passed */\n  rawParams: Record<string, any>;\n}\n\n/** Describes an action triggered by calling a mutation in the app's generated GraphQL API */\nexport interface APIActionTrigger extends PublicAPIActionTrigger {\n  type: \"api\";\n}\n\n/** Describes an action triggered by running a sync on a Shopify model. */\nexport interface ShopifySyncActionTrigger {\n  type: \"shopify_sync\";\n  /** The shop id being synced */\n  shopId: string;\n  /** The API version of the shop being synced */\n  apiVersion: string;\n  /** The available oauth scopes of the shop being synced */\n  shopifyScopes: string[];\n  /** The id of the sync record tracking the state of this sync, if available */\n  syncId?: string;\n  /** The specified date range of this sync, if set when the sync was started */\n  syncSince?: string;\n  /** The list of model apiIdentifiers this sync will work on. */\n  models: string[];\n  /** If this sync is being run in force mode, which will always run actions, even if the updated_at timestamps match between Gadget and Shopify */\n  force: boolean;\n  /** The string reason why this sync was started if set when the sync began */\n  startReason?: string;\n}\n\n/** Describes an action run by one event on a schedule */\nexport interface SchedulerActionTrigger {\n  type: \"scheduler\";\n}\n\n/** Describes an action run as a background job */\nexport interface BackgroundActionTrigger extends Omit<APIActionTrigger, \"type\"> {\n  type: \"background-action\";\n  /** How many attempts we have made to run this job */\n  attemptNumber: number;\n  /** Whether this is the final attempt */\n  finalAttempt: boolean;\n  /** ID of the background action record */\n  id: string;\n  priority: string;\n  queue?: {\n    name: string;\n    maxConcurrency: number;\n  };\n}\n\n/** Describes an action run by a Shopify merchant completing the OAuth process to install an application */\nexport interface ShopifyOAuthActionTrigger {\n  type: \"shopify_oauth\";\n}\n\n/** Describes an action run by a Shopify Admin app being installed into Gadget */\nexport interface ShopifyAdminActionTrigger {\n  type: \"shopify_admin\";\n}\n\n/** Describes an action run by a Shopify customer who has logged in to a customer UI extension that has called this app */\nexport interface ShopifyCustomerAccountLoginTrigger {\n  type: \"shopify_customer_account_login\";\n}\n\n/** Represents actions triggered by happenings inside the Gadget platform, like maintenance, or administrative actions taken inside the Gadget editor */\nexport interface PlatformTrigger {\n  type: \"platform\";\n  reason: string;\n}\n\n/** Represents actions triggered by tests within the Gadget platform */\nexport interface MockActionTrigger {\n  type: \"mock\";\n}\n\nexport interface BigCommerceOauthActionTrigger {\n  type: \"bigcommerce_oauth\";\n}\n\nexport interface BigCommerceUninstallAppTrigger {\n  type: \"bigcommerce_uninstall\";\n  signed_payload_jwt: string;\n}\n\nexport interface BigCommerceRemoveUserAppTrigger {\n  type: \"bigcommerce_remove_user\";\n  signed_payload_jwt: string;\n}\n\n/** Describes an action triggered by running a BigCommerce webhook */\nexport interface BigCommerceWebhookActionTrigger {\n  type: \"bigcommerce_webhook\";\n  /** The scope of the incoming webhook from BigCommerce, like store/products/updated or store/orders/* */\n  scope: string;\n  /** The raw incoming data from BigCommerce */\n  data: Record<string, any>;\n  /** The storeHash of the store producing the webhook */\n  storeHash: string;\n  /** The time at which the webhook was created */\n  createdAt: number;\n  /** A hash sent by BigCommerce with each webhook to help with duplicate events */\n  hash: string;\n  /** The number of times this webhook has been retried */\n  retries: number;\n}\n\nexport interface GoogleOAuthActionTrigger {\n  user: {\n    given_name: string;\n    family_name: string;\n    email: string;\n    email_verified: string;\n    name: string;\n    picture: string;\n    hd: string;\n    locale: string;\n  };\n  token?: {\n    token_type: string;\n    id_token: string;\n    access_token: string;\n    refresh_token?: string;\n    expires_in: number;\n    scope: string;\n  };\n}\n\nexport interface GoogleOAuthSignInActionTrigger extends GoogleOAuthActionTrigger {\n  type: \"google_oauth_signin\";\n}\nexport interface GoogleOAuthSignUpActionTrigger extends GoogleOAuthActionTrigger {\n  type: \"google_oauth_signup\";\n}\n\nexport interface GadgetEmailPasswordSignUpTrigger extends PublicAPIActionTrigger {\n  type: \"user_sign_up\";\n}\n\nexport interface GadgetEmailPasswordSignInTrigger extends PublicAPIActionTrigger {\n  type: \"user_sign_in\";\n}\n\nexport interface GadgetEmailPasswordResetTrigger extends PublicAPIActionTrigger {\n  type: \"user_reset_password\";\n}\n\nexport interface GadgetEmailPasswordSendResetTrigger extends PublicAPIActionTrigger {\n  type: \"user_send_reset_password\";\n}\n\nexport interface GadgetEmailPasswordVerifyTrigger extends PublicAPIActionTrigger {\n  type: \"user_verify_email\";\n}\n\nexport interface GadgetEmailPasswordSendVerifyTrigger extends PublicAPIActionTrigger {\n  type: \"user_send_verify_email\";\n}\n\nexport interface GadgetEmailPasswordChangePasswordTrigger extends PublicAPIActionTrigger {\n  type: \"user_change_password\";\n}\n\nexport interface GadgetUserSignOutTrigger extends PublicAPIActionTrigger {\n  type: \"user_sign_out\";\n}\n\nexport type ActionTrigger =\n  | ShopifyWebhookActionTrigger\n  | APIActionTrigger\n  | ShopifySyncActionTrigger\n  | SchedulerActionTrigger\n  | BackgroundActionTrigger\n  | ShopifyOAuthActionTrigger\n  | ShopifyAdminActionTrigger\n  | ShopifyCustomerAccountLoginTrigger\n  | PlatformTrigger\n  | MockActionTrigger\n  | GoogleOAuthSignInActionTrigger\n  | GoogleOAuthSignUpActionTrigger\n  | GadgetEmailPasswordSignUpTrigger\n  | GadgetEmailPasswordSignInTrigger\n  | GadgetEmailPasswordResetTrigger\n  | GadgetEmailPasswordSendResetTrigger\n  | GadgetEmailPasswordVerifyTrigger\n  | GadgetEmailPasswordSendVerifyTrigger\n  | GadgetEmailPasswordChangePasswordTrigger\n  | GadgetUserSignOutTrigger\n  | BigCommerceOauthActionTrigger\n  | BigCommerceUninstallAppTrigger\n  | BigCommerceRemoveUserAppTrigger\n  | BigCommerceWebhookActionTrigger;\n\nexport type ConfigurationVariablesBlob = Record<string, string | null>;\n\n/** @hidden */\nexport type FindRecordCondition = Record<string, any>;\n\n/**\n * The base attributes most records have\n **/\nexport interface BaseRecord {\n  __typename?: string;\n  id?: string;\n  state?: any;\n  stateHistory?: any;\n  [key: string]: any;\n}\n\nexport interface AnyBulkRecordLoader {\n  loadRecord(apiIdentifier: string, namespace: string[], condition: FindRecordCondition): Promise<GadgetRecord<BaseRecord> | undefined>;\n}\n\n/** Gadget's Error tracking object used in validation code effects for adding errors when a validation fails.*/\nexport interface ValidationErrors {\n  /**\n   * Add an error to the errors list for a given field\n   * @param {string} field - The `apiIdentifier` of the field you wish to add an error to\n   * @param {string} message - A mesage describing the error in detail.\n   */\n  add(field: string, message: string): void;\n\n  /**\n   * Returns the number of errors for this record validation pass.\n   */\n  get size(): number;\n\n  /**\n   * Returns `true` if there are no errors, otherwise returns `false`.\n   */\n  get empty(): boolean;\n\n  /**\n   * Returns an array of objects containing the field's `apiIdentifier` and the error `message` string for all errors added so far.\n   */\n  list: { apiIdentifier: string; message: string }[];\n\n  /**\n   * Returns a simplified JSON object representing the error messages grouped by `apiIdentifier`\n   */\n  toJSON(): {\n    [apiIdentifier: string]: string[];\n  };\n}\n\n/** A generic interface for an object that doesn't have a committed a public interface. */\nexport interface NotYetTyped {\n  [key: string]: any;\n}\n\nexport interface AnyParams {\n  [key: string]: string | number | boolean | object | bigint | null | undefined;\n}\n\nexport interface ActionDescriptor {\n  key: string;\n  type: \"Action\" | \"ModelAction\";\n  apiIdentifier: string;\n  timeoutMilliseconds: number;\n  hasReturnType: boolean;\n}\n\nexport interface GlobalActionDescriptor {\n  key: string;\n  type: \"GlobalAction\";\n  apiIdentifier: string;\n  timeoutMilliseconds: number;\n  hasReturnType: boolean;\n}\n\nexport interface ModelDescriptor extends ModelMetadata {\n  validator: {\n    validate(context: AnyEffectContext, record: GadgetRecord<BaseRecord>): Promise<void>;\n  };\n}\n/** Represents the data that's in always context */\nexport interface AnyAmbientContext {\n  /** The current request's session, if it has one. Requests made by browsers are given sessions, but requests made using Gadget API Keys are not. */\n  session: Session | null;\n  /** The current request's session ID, if it has one. Requests made by browsers are given sessions, but requests made using Gadget API Keys are not. */\n  sessionID: string | null;\n  /** All <%- applicationName %> configuration values */\n  config: ConfigurationVariablesBlob;\n  /** A map of connection name to instantiated connection objects for <%- applicationName %> */\n  connections: Record<string, unknown>;\n\n  /** A signal for if/when the request for processing this unit of work gets prematurely aborted. Useful for passing along to long running requests that should be interrupted when the client goes away. */\n  signal: AbortSignal;\n\n  /** A high performance structured logger which writes logs to the Logs Viewer in the Gadget Editor. */\n  logger: Logger;\n  /**\n   * An instance of the API client for <%- applicationName %>.\n   *\n   * __Note__: This client is authorized using a superuser internal api token and has permission to invoke any action in the system using normal API mutations or the Internal API.\n   **/\n  api: AnyClient;\n  /**\n   * The details of the request that is invoking this unit of work, if it was invoked by a request.\n   *\n   * __Note__: Request details are not always present, like during a background connection sync, a background job, or an action retry.\n   **/\n  request?: RequestData;\n  /**\n   * A unique identifier for this context\n   */\n  id: string;\n  /**\n   * A boolean describing if this unit of work will be retried automatically or not\n   */\n  willRetry?: boolean;\n  /** App URL for the current environment e.g. https://example.gadget.app */\n  currentAppUrl: string;\n  /** An object for sending emails */\n  emails: GadgetMailer;\n  /**\n   * The current tenancy for this unit of work\n   * @internal\n   */\n  [AppTenancyKey]?: AppTenancy;\n  /** @internal */\n  loaders: AnyBulkRecordLoader;\n  /** @internal */\n  effectAPIs: any;\n  /** @internal */\n  authConfig?: AuthenticationConfiguration;\n}\n\nexport type GadgetConfig = {\n  apiKeys: {\n    shopify?: string;\n  };\n  environment?: string | null;\n  env: {\n    GADGET_APP: string;\n    GADGET_ENV?: string;\n    GADGET_PUBLIC_APP_SLUG: string;\n    GADGET_PUBLIC_APP_ENV?: string;\n    GADGET_PUBLIC_SHOPIFY_APP_URL?: string;\n  } & { [key: string]: string | undefined };\n  shopifyInstallState?: {\n    redirectToOauth: boolean;\n    isAuthenticated: boolean;\n    missingScopes: string[];\n  };\n  authentication?: Pick<AuthenticationConfiguration, \"signInPath\" | \"redirectOnSuccessfulSignInPath\">;\n};\n\n/** The context for a request passed to an HTTP route */\nexport interface AnyRequestContext extends AnyAmbientContext {\n  gadgetConfig: GadgetConfig;\n  gadgetContext: Record<string, any>;\n  currentAppUrl: string;\n  request: FastifyRequest;\n  reply: FastifyReply;\n  /** @deprecated */\n  applicationIdentity: any | null;\n  /** @deprecated */\n  applicationSessionID?: string | null;\n  /** @deprecated */\n  applicationSession?: Session | null;\n  /** A signal for if/when the request for processing this unit of work gets prematurely aborted. Useful for passing along to long running requests that should be interrupted when the client goes away. */\n  signal: AbortSignal;\n}\n\nexport interface BaseActionContext extends AnyAmbientContext {\n  /** Details about what triggered this action or global action to run */\n  trigger: ActionTrigger;\n\n  /**\n   * An object passed between all preconditions and effects of an action execution at the \\`scope\\` property.\n   * Useful for transferring data between effects.\n   */\n  scope: ActionExecutionScope;\n\n  /**\n   * @internal\n   */\n  [AppTenancyKey]?: AppTenancy;\n}\n\n/**\n * An action context type for use in actions that can run on any model.\n */\nexport interface AnyActionContext extends BaseActionContext {\n  type: \"action\";\n\n  /** Details about the action being executed */\n  action: ActionDescriptor;\n\n  /**\n   * The record this action is operating on.\n   */\n  record: GadgetRecord<BaseRecord>;\n\n  /**\n   * The model this action is for.\n   */\n  model: ModelDescriptor;\n\n  /**\n   * The parameters passed to the action.\n   */\n  params: AnyParams;\n\n  /** The phase of execution we're running currently */\n  phase: \"precondition\" | \"run\" | \"success\" | \"failure\";\n\n  /**\n   * The current context for this action\n   */\n  context: AnyActionContext;\n\n  /**\n   * @deprecated\n   */\n  transition?: {\n    type: \"Transition\";\n    key: string;\n    actionKey: string;\n    fromStateKey: string;\n    toStateKey: string;\n  };\n}\n\n/**\n * Describes the context passed to every global action.\n */\nexport interface AnyGlobalActionContext extends BaseActionContext {\n  type: \"global-action\";\n\n  /** Details about the global action being executed */\n  action: GlobalActionDescriptor;\n\n  /** What phase of execution this global action is currently in */\n  phase: \"precondition\" | \"run\" | \"success\" | \"failure\";\n\n  /**\n   * The parameters passed to the action.\n   */\n  params: AnyParams;\n\n  /**\n   * The current context for this global action\n   */\n  context: AnyGlobalActionContext;\n}\n\n/**\n * Represents all the context available when executing one effect of an action or global action\n **/\nexport interface AnyEffectContext extends BaseActionContext {\n  type: \"effect\";\n  effect: {\n    spec: { id: string };\n    configuration: Record<string, any>;\n  };\n  /**\n   * The parameters passed to this effect.\n   */\n  params: AnyParams;\n  /**\n   * The specific connection this effect has been contributed by\n   **/\n  connection?: unknown;\n  model?: ModelDescriptor; // present for effects on actions, not present for effects on GlobalActions\n  record?: GadgetRecord<BaseRecord>; // present for effects on actions, not present for effects on GlobalActions\n}\n\n/**\n * Represents all the context available when executing one precondition of an action or global action\n * @deprecated\n **/\nexport interface AnyPreconditionContext extends BaseActionContext {\n  type: \"precondition\";\n  condition: {\n    spec: { id: string };\n    configuration: Record<string, any>;\n  };\n  model?: ModelDescriptor; // present for effects on actions, not present for effects on GlobalActions\n  record?: GadgetRecord<BaseRecord>; // present for effects on actions, not present for effects on GlobalActions\n  params: AnyParams;\n}\n\nexport type ActionContextForBlob<T> = T extends { type: \"Action\" }\n  ? AnyActionContext\n  : T extends { type: \"GlobalAction\" }\n  ? AnyGlobalActionContext\n  : never;\n\n/**\n * @hidden\n */\nexport interface FieldMetadata {\n  fieldType: string;\n  key: string;\n  name: string;\n  apiIdentifier: string;\n  configuration: { [key: string]: any };\n  internalWritable: boolean;\n}\n\n/**\n * @hidden\n */\nexport interface ModelMetadata {\n  key: string;\n  name: string;\n  apiIdentifier: string;\n  namespace: string[];\n  fields: {\n    [key: string]: FieldMetadata;\n  };\n  graphqlTypeName: string;\n  stateChart: any;\n}\n\n/** Gadget wrapper for NodeMailer, used to facilitate the sending of emails.*/\nexport interface GadgetMailer {\n  /** Verifies SMTP configuration */\n  verifyConnection(): Promise<void>;\n  /** Sets the transport configuration used for transporting emails */\n  setTransport(\n    transport: SMTPTransportConfig | SendmailTransportConfig | StreamTransportConfig | JSONTransportConfig | SESTransportConfig\n  ): void;\n  /** Sends the email using the set transporter */\n  sendMail(mailData: MailData): Promise<void>;\n  /** Renders an ejs template */\n  render(template: string, data: any): string;\n}\n\n/**\n * @internal\n */\nexport interface AuthenticationConfigurationMethod {\n  specID: string;\n  configuration?:\n    | {\n        type: \"GoogleMethodConfiguration\";\n        gadgetManagedCredentials: boolean;\n        callbackPath: string;\n        scopes: string[];\n        redirectOnSuccessfulSignInPath?: string | null;\n        credentials: {\n          clientID?: string;\n          clientSecret?: string;\n        };\n        offlineMode: boolean;\n      }\n    | {\n        type: \"EmailPasswordMethodConfiguration\";\n      };\n}\n\n/**\n * @internal\n */\nexport interface AuthenticationConfiguration {\n  signInPath: string;\n  redirectOnForbidden: boolean;\n  sessionExpirationMs: number;\n  defaultAuthRoles: string[];\n  redirectOnSuccessfulSignInPath?: string;\n  methods?: AuthenticationConfigurationMethod[];\n}\n\n/** The options for the mail object being sent */\nexport type MailData = {\n  to: string | string[] | Address | Array<string | Address>;\n  subject?: string;\n  /** The body of the email */\n  html?: string;\n  /** The From address displayed to users as to who the email came from. If using Gadget transport, must end in the app's approved subdomain, the value of primaryDomain found in Config. If one is not provided then a default address for the app will be used */\n  from?: string | Address;\n  /** The Sender header used to identify the agent responsible for the actual transmission of the email. Can only be set when using a Custom transport */\n  sender?: string | Address;\n};\n\nexport type Address = {\n  name: string;\n  address: string;\n};\n"],
  "mappings": ";;;;;;;;;;;;;;AAAA;AAAA;",
  "names": []
}
