{"version":3,"sources":["/app/packages/framework/src/Session.ts"],"sourceRoot":"/app","sourcesContent":["/**\n * Bag of key-values associated with the current actor running this request or action\n **/\nexport class Session {\n  static fromInput(input?: Record<string, any>): Session | undefined {\n    if (input) {\n      return new Session(input.id, input);\n    }\n  }\n\n  changedKeys: Set<string> = new Set<string>();\n  ended = false;\n  touched = false;\n  #storage: Record<string, any>;\n\n  constructor(private _id: string | null, obj: Record<string, any>) {\n    this.#storage = obj;\n  }\n\n  get(key: string): any {\n    return this.#storage[key];\n  }\n\n  set(key: string, value: any): void {\n    this.changedKeys.add(key);\n    this.#storage[key] = value;\n  }\n\n  touch(): void {\n    this.touched = true;\n  }\n\n  delete(key: string): void {\n    this.changedKeys.add(key);\n    this.#storage[key] = null;\n  }\n\n  end(): void {\n    this.changedKeys.add(\"id\");\n    this.ended = true;\n  }\n\n  clearChanges(): void {\n    this.changedKeys.clear();\n  }\n\n  get changed(): boolean {\n    return this.changedKeys.size > 0;\n  }\n\n  toJSON(): Record<string, any> {\n    return this.#storage;\n  }\n\n  toChangedJSON(): Record<string, any> {\n    const changes: Record<string, any> = {};\n    for (const key of this.changedKeys) {\n      changes[key] = this.#storage[key];\n    }\n    return changes;\n  }\n\n  get id() {\n    return this._id;\n  }\n\n  set id(value: string | null) {\n    this._id = value;\n    this.set(\"id\", this._id);\n  }\n}\n"],"names":["Session","fromInput","input","id","changedKeys","ended","touched","constructor","_id","obj","Set","get","key","set","value","add","touch","delete","end","clearChanges","clear","changed","size","toJSON","toChangedJSON","changes"],"mappings":"AAAA;;EAEE;;;;+BACWA;;;eAAAA;;;AAAN,MAAMA;;IACX,OAAOC,UAAUC,KAA2B,EAAuB;QACjE,IAAIA,OAAO;YACT,OAAO,IAAIF,QAAQE,MAAMC,EAAE,EAAED;QAC/B;IACF;IAEAE,YAA6C;IAC7CC,MAAc;IACdC,QAAgB;IAChB,CAAA,OAAQ,CAAsB;IAE9BC,YAAY,AAAQC,GAAkB,EAAEC,GAAwB,CAAE;aAA9CD,MAAAA;aALpBJ,cAA2B,IAAIM;aAC/BL,QAAQ;aACRC,UAAU;QAIR,IAAI,CAAC,CAAA,OAAQ,GAAGG;IAClB;IAEAE,IAAIC,GAAW,EAAO;QACpB,OAAO,IAAI,CAAC,CAAA,OAAQ,CAACA,IAAI;IAC3B;IAEAC,IAAID,GAAW,EAAEE,KAAU,EAAQ;QACjC,IAAI,CAACV,WAAW,CAACW,GAAG,CAACH;QACrB,IAAI,CAAC,CAAA,OAAQ,CAACA,IAAI,GAAGE;IACvB;IAEAE,QAAc;QACZ,IAAI,CAACV,OAAO,GAAG;IACjB;IAEAW,OAAOL,GAAW,EAAQ;QACxB,IAAI,CAACR,WAAW,CAACW,GAAG,CAACH;QACrB,IAAI,CAAC,CAAA,OAAQ,CAACA,IAAI,GAAG;IACvB;IAEAM,MAAY;QACV,IAAI,CAACd,WAAW,CAACW,GAAG,CAAC;QACrB,IAAI,CAACV,KAAK,GAAG;IACf;IAEAc,eAAqB;QACnB,IAAI,CAACf,WAAW,CAACgB,KAAK;IACxB;IAEA,IAAIC,UAAmB;QACrB,OAAO,IAAI,CAACjB,WAAW,CAACkB,IAAI,GAAG;IACjC;IAEAC,SAA8B;QAC5B,OAAO,IAAI,CAAC,CAAA,OAAQ;IACtB;IAEAC,gBAAqC;QACnC,MAAMC,UAA+B,CAAC;QACtC,KAAK,MAAMb,OAAO,IAAI,CAACR,WAAW,CAAE;YAClCqB,OAAO,CAACb,IAAI,GAAG,IAAI,CAAC,CAAA,OAAQ,CAACA,IAAI;QACnC;QACA,OAAOa;IACT;IAEA,IAAItB,KAAK;QACP,OAAO,IAAI,CAACK,GAAG;IACjB;IAEA,IAAIL,GAAGW,KAAoB,EAAE;QAC3B,IAAI,CAACN,GAAG,GAAGM;QACX,IAAI,CAACD,GAAG,CAAC,MAAM,IAAI,CAACL,GAAG;IACzB;AACF"}